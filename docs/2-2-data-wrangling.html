<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="2.2 Data Wrangling | Rotterdam" />
<meta property="og:type" content="book" />





<meta name="author" content="JACK TAN, YIMING MIAO" />

<meta name="date" content="2021-03-14" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="2.2 Data Wrangling | Rotterdam">

<title>2.2 Data Wrangling | Rotterdam</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li class="has-sub"><a href="index.html#motivation"><span class="toc-section-number">1</span> Motivation</a><ul>
<li><a href="1-1-some-background-information.html#some-background-information"><span class="toc-section-number">1.1</span> Some Background Information</a></li>
</ul></li>
<li class="has-sub"><a href="2-data-exploration.html#data-exploration"><span class="toc-section-number">2</span> Data Exploration</a><ul>
<li><a href="2-1-loading-data.html#loading-data"><span class="toc-section-number">2.1</span> Loading Data</a></li>
<li class="has-sub"><a href="2-2-data-wrangling.html#data-wrangling"><span class="toc-section-number">2.2</span> Data Wrangling</a><ul>
<li><a href="2-2-data-wrangling.html#ttumornnodemmetastasis"><span class="toc-section-number">2.2.1</span> T(Tumor)N(Node)M(Metastasis)</a></li>
<li><a href="2-2-data-wrangling.html#treatment"><span class="toc-section-number">2.2.2</span> Treatment</a></li>
</ul></li>
<li class="has-sub"><a href="2-3-data-visualizations-and-exploration.html#data-visualizations-and-exploration"><span class="toc-section-number">2.3</span> Data visualizations and exploration</a><ul>
<li><a href="2-3-data-visualizations-and-exploration.html#diagnostics-vs.-survival-times"><span class="toc-section-number">2.3.1</span> Diagnostics vs. Survival Times</a></li>
<li><a href="2-3-data-visualizations-and-exploration.html#treatment-vs.-survival-times"><span class="toc-section-number">2.3.2</span> Treatment vs. Survival Times</a></li>
<li><a href="2-3-data-visualizations-and-exploration.html#age-treatment-vs.-survival-times"><span class="toc-section-number">2.3.3</span> <code>age</code> + <code>Treatment</code> vs. Survival Times</a></li>
<li><a href="2-3-data-visualizations-and-exploration.html#treatment-vs.-tnm"><span class="toc-section-number">2.3.4</span> <code>Treatment</code> vs. TNM</a></li>
<li><a href="2-3-data-visualizations-and-exploration.html#general-x-year-survival-rate"><span class="toc-section-number">2.3.5</span> General X-year Survival Rate</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="3-survival-analysis.html#survival-analysis"><span class="toc-section-number">3</span> Survival Analysis</a><ul>
<li><a href="3-1-notation.html#notation"><span class="toc-section-number">3.1</span> Notation</a></li>
<li><a href="3-2-kaplan-miere-estimator-of-the-entire-dataset.html#kaplan-miere-estimator-of-the-entire-dataset"><span class="toc-section-number">3.2</span> Kaplan-Miere estimator of the entire dataset</a></li>
<li class="has-sub"><a href="3-3-kaplan-miere-estimator-on-different-variables-in-rotterdam.html#kaplan-miere-estimator-on-different-variables-in-rotterdam"><span class="toc-section-number">3.3</span> Kaplan-Miere estimator on different variables in <code>rotterdam</code></a><ul>
<li><a href="3-3-kaplan-miere-estimator-on-different-variables-in-rotterdam.html#size-vs.-survival-times"><span class="toc-section-number">3.3.1</span> <code>size</code> vs. Survival Times</a></li>
<li><a href="3-3-kaplan-miere-estimator-on-different-variables-in-rotterdam.html#nodes_level-vs.-survival-times"><span class="toc-section-number">3.3.2</span> <code>Nodes_level</code> vs. Survival Times</a></li>
<li><a href="3-3-kaplan-miere-estimator-on-different-variables-in-rotterdam.html#grade-vs.-survival-times"><span class="toc-section-number">3.3.3</span> <code>grade</code> vs. Survival Times</a></li>
<li><a href="3-3-kaplan-miere-estimator-on-different-variables-in-rotterdam.html#treatment-vs.-survival-times-1"><span class="toc-section-number">3.3.4</span> <code>Treatment</code> vs. Survival Times</a></li>
</ul></li>
<li class="has-sub"><a href="3-4-parametric-models.html#parametric-models"><span class="toc-section-number">3.4</span> Parametric Models</a><ul>
<li><a href="3-4-parametric-models.html#user-defined-cox-snell-function"><span class="toc-section-number">3.4.1</span> User-defined Cox-Snell function</a></li>
<li><a href="3-4-parametric-models.html#exponential-and-weibull"><span class="toc-section-number">3.4.2</span> Exponential and Weibull</a></li>
<li><a href="3-4-parametric-models.html#log-normal-models"><span class="toc-section-number">3.4.3</span> Log-normal models</a></li>
</ul></li>
<li class="has-sub"><a href="3-5-cox-ph-model.html#cox-ph-model"><span class="toc-section-number">3.5</span> Cox-PH model:</a><ul>
<li><a href="3-5-cox-ph-model.html#cox-ph-model-for-dtime"><span class="toc-section-number">3.5.1</span> Cox-PH model for <code>dtime</code></a></li>
<li><a href="3-5-cox-ph-model.html#cox-ph-model-for-rtime"><span class="toc-section-number">3.5.2</span> Cox-PH model for <code>rtime</code></a></li>
</ul></li>
<li><a href="3-6-summary.html#summary"><span class="toc-section-number">3.6</span> Summary</a></li>
</ul></li>
<li class="has-sub"><a href="4-random-survival-forest.html#random-survival-forest"><span class="toc-section-number">4</span> Random Survival Forest</a><ul>
<li><a href="4-1-dtime.html#dtime"><span class="toc-section-number">4.1</span> <code>dtime</code></a></li>
<li><a href="4-2-rtime.html#rtime"><span class="toc-section-number">4.2</span> <code>rtime</code></a></li>
</ul></li>
<li class="has-sub"><a href="5-conclusion.html#conclusion"><span class="toc-section-number">5</span> Conclusion</a><ul>
<li><a href="5-1-limitation.html#limitation"><span class="toc-section-number">5.1</span> Limitation</a></li>
<li><a href="5-2-reference.html#reference"><span class="toc-section-number">5.2</span> Reference</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="data-wrangling" class="section level2">
<h2><span class="header-section-number">2.2</span> Data Wrangling</h2>
<div id="ttumornnodemmetastasis" class="section level3">
<h3><span class="header-section-number">2.2.1</span> T(Tumor)N(Node)M(Metastasis)</h3>
<div id="size-for-ttumor" class="section level5">
<h5><span class="header-section-number">2.2.1.0.1</span> <code>size</code> for T(Tumor):</h5>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">rotterdam <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(size) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">number =</span> <span class="kw">n</span>(), <span class="dt">.groups =</span> <span class="st">&#39;drop&#39;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   size  number
##   &lt;fct&gt;  &lt;int&gt;
## 1 &lt;=20    1387
## 2 20-50   1291
## 3 &gt;50      304</code></pre>
<p>We can see that most of the patients in the database have tumor size smaller than 50mm.</p>
</div>
<div id="nodes-for-nnode" class="section level5">
<h5><span class="header-section-number">2.2.1.0.2</span> <code>nodes</code> for N(Node):</h5>
<p>The number of lymph nodes tested positive is another important measure in the TNM system.</p>
<p>For visualization purpose, we will make a new categorical variable called <code>Nodes_level</code>. For lymph nodes tested positive, the usual medical way of classifying the severity would be:<code>N0</code> for no positive nodes; <code>N1</code> for 1-3 positive nodes; <code>N2</code> for 4-9 positive nodes; and <code>N3</code> for more than 10 nodes. We will follow this classification method.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">rotterdam &lt;-<span class="st"> </span>rotterdam <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Nodes_level =</span> <span class="kw">ifelse</span>(nodes <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;N0&quot;</span>, </a>
<a class="sourceLine" id="cb4-3" title="3">                       <span class="kw">ifelse</span>(nodes <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>nodes <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>, <span class="st">&quot;N1&quot;</span>, </a>
<a class="sourceLine" id="cb4-4" title="4">                       <span class="kw">ifelse</span>(nodes <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span> <span class="op">&amp;</span><span class="st"> </span>nodes <span class="op">&lt;=</span><span class="st"> </span><span class="dv">9</span>, <span class="st">&quot;N2&quot;</span>, </a>
<a class="sourceLine" id="cb4-5" title="5">                       <span class="kw">ifelse</span>(nodes <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>, <span class="st">&quot;N3&quot;</span>, <span class="ot">NaN</span>)))))</a>
<a class="sourceLine" id="cb4-6" title="6">rotterdam <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="st">  </span><span class="kw">group_by</span>(Nodes_level) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">number =</span> <span class="kw">n</span>(), <span class="dt">.groups =</span> <span class="st">&#39;drop&#39;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   Nodes_level number
##   &lt;chr&gt;        &lt;int&gt;
## 1 N0            1436
## 2 N1             764
## 3 N2             515
## 4 N3             267</code></pre>
</div>
<div id="grade-for-mmetastasis" class="section level5">
<h5><span class="header-section-number">2.2.1.0.3</span> <code>grade</code> for M(Metastasis):</h5>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">rotterdam &lt;-<span class="st"> </span>rotterdam <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">grade =</span> <span class="kw">as.factor</span>(grade))</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">rotterdam <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(grade) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">number =</span> <span class="kw">n</span>(), <span class="dt">.groups =</span> <span class="st">&#39;drop&#39;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   grade number
##   &lt;fct&gt;  &lt;int&gt;
## 1 2        794
## 2 3       2188</code></pre>
<p>In our dataset, we could see that all of the breast cancer patients are in grade II or grade III, which means that the cancer cells may start shifting to other parts of their body.</p>
</div>
</div>
<div id="treatment" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Treatment</h3>
<p>As we were examining through the data, we found that upon the <code>chemo</code> variable and the <code>hormon</code> variable, there are instances where patients gets both therapy or neither. So in order to explore the relationship between treatment and survival, we introduce a new variable called <code>Treatment</code>, using the <code>chemo</code> and <code>hormon</code> variables.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">rotterdam &lt;-<span class="st"> </span>rotterdam <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Treatment =</span> <span class="kw">ifelse</span>(chemo <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>hormon <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;Chemo&quot;</span>,</a>
<a class="sourceLine" id="cb9-3" title="3">                     <span class="kw">ifelse</span>(chemo <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>hormon <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Hormon&quot;</span>, </a>
<a class="sourceLine" id="cb9-4" title="4">                     <span class="kw">ifelse</span>(chemo <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>hormon <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Both&quot;</span>, <span class="st">&quot;NaN/Other Treatment&quot;</span>)))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Treatment =</span> <span class="kw">as.factor</span>(Treatment))</a></code></pre></div>
<p>Note that in this manner as we try to ‘merge’ two binary variables into one variable with four levels, we are assuming interaction between <code>chemo</code> and <code>hormon</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">rotterdam_recur &lt;-<span class="st"> </span>rotterdam <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="st">  </span><span class="kw">filter</span>(recur <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">drecurtime =</span> dtime<span class="op">-</span>rtime)</a>
<a class="sourceLine" id="cb10-4" title="4"><span class="kw">nrow</span>(rotterdam_recur)</a></code></pre></div>
<pre><code>## [1] 1518</code></pre>
<p>We also thought it would be of interest to invesigate how recurrnce of tumor might affect the survival of the patient. We made a new dataset called <code>rotterdam_recur</code>, which only include patients with <code>recur</code> = 1. Now the dataset contains 1518 data points, a little over the original <code>rotterdam</code> dataset. We will label the time from recurrence to death as <code>drecurtime</code> in the new data frame.</p>
</div>
</div>
<p style="text-align: center;">
<a href="2-1-loading-data.html"><button class="btn btn-default">Previous</button></a>
<a href="2-3-data-visualizations-and-exploration.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
